<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Dashboard - Smart Attendance System</title>
    
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #d4e4f7;
            min-height: 100vh; 
            color: #333; 
        }
        
        /* College Header */
        .college-header {
            background: white;
            padding: 0;
            box-shadow: 0 3px 15px rgba(0,0,0,0.2);
            border-bottom: 4px solid #0066cc;
            position: relative;
        }
        
        .college-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://tse2.mm.bing.net/th/id/OIP.6ovpqbKMeQO3k-48Le01IAHaEU?pid=Api&P=0&h=180') center/cover;
            opacity: 0.2;
            z-index: 0;
        }
        
        .header-banner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            padding: 15px 20px;
            position: relative;
            z-index: 1;
        }
        
        .header-logo {
            flex-shrink: 0;
        }
        
        .header-logo img {
            width: 180px;
            height: 180px;
            object-fit: contain;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.15));
        }
        
        .header-logo img:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.25));
        }
        
        .header-center {
            flex: 1;
            text-align: center;
        }
        
        .header-top-info {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 5px;
            font-size: 0.85em;
            color: #666;
        }
        
        .estd {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .counselling {
            color: #0066cc;
            font-weight: bold;
        }
        
        .college-name {
            font-size: 1.8em;
            color: #006633;
            font-weight: bold;
            margin: 5px 0;
            letter-spacing: 1px;
        }
        
        .autonomous {
            color: #e74c3c;
            font-size: 0.8em;
        }
        
        .sponsored {
            font-size: 0.9em;
            color: #333;
            margin: 5px 0;
        }
        
        .sponsored a {
            color: #0066cc;
            text-decoration: none;
        }
        
        .address {
            font-size: 0.85em;
            color: #e74c3c;
            font-weight: 600;
        }
        
        /* Dashboard Header */
        .dashboard-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .dashboard-title {
            font-size: 1.3em;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: white;
            color: #3498db;
        }
        
        /* Main Layout */
        .main-layout {
            display: flex;
            max-width: 1600px;
            margin: 20px auto;
            gap: 20px;
            padding: 0 20px;
        }
        
        /* Left Sidebar */
        .left-sidebar {
            width: 280px;
            flex-shrink: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 20px;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .sidebar-title {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .selection-group {
            margin-bottom: 25px;
        }
        
        .selection-group label {
            display: block;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.95em;
        }
        
        .selection-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .selection-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.1);
        }
        
        .selection-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .selection-info h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .selection-info p {
            color: #666;
            font-size: 0.85em;
            margin: 5px 0;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            min-width: 0;
        }
        
        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        
        .stat-icon {
            font-size: 2.5em;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        .stat-info h3 {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        
        .stat-info .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        /* Control Panel */
        .control-panel {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .control-panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .control-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Attendance Table */
        .attendance-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .attendance-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        thead {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        tbody tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .status-present {
            background: #d4edda;
            color: #155724;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #2c3e50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            font-weight: 500;
            max-width: 350px;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: #27ae60;
        }
        
        .toast.error {
            background: #e74c3c;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .header-banner {
                flex-direction: column;
                text-align: center;
            }
            
            .header-top-info {
                flex-direction: column;
                gap: 5px;
            }
            
            .college-name {
                font-size: 1.5em;
            }
            
            .main-layout {
                flex-direction: column;
            }
            
            .left-sidebar {
                width: 100%;
                position: static;
            }
        }
        
        @media (max-width: 768px) {
            .header-logo img {
                width: 120px;
                height: 120px;
            }
            
            .college-name {
                font-size: 1.3em;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .control-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>

    <!-- College Header Banner -->
    <div class="college-header">
        <div class="header-banner">
            <div class="header-logo">
                <img src="https://tse2.mm.bing.net/th/id/OIP.sxJEIIohO5to28ssExKhvwAAAA?pid=Api&P=0&h=180" 
                     alt="Sri Vasavi Engineering College Logo">
            </div>
            
            <div class="header-center">
                <div class="header-top-info">
                    <span class="estd">ESTD: 2001</span>
                    <span class="counselling">COUNSELLING CODE: VSVT</span>
                </div>
                <h1 class="college-name">
                    SRI VASAVI ENGINEERING COLLEGE 
                    <span class="autonomous">(AUTONOMOUS)</span>
                </h1>
                <p class="sponsored">
                    Sponsored by: <span style="color: #e74c3c;">SRI VASAVI EDUCATIONAL SOCIETY</span>, 
                    website: <a href="http://www.srivasaviengg.ac.in" target="_blank">www.srivasaviengg.ac.in</a>
                </p>
                <p class="address">Pedatadepalli, Tadepalligudem ‚Äì 534 101, W.G.Dist, (A.P.)</p>
            </div>
            
            <div class="header-logo">
                <img src="https://tse2.mm.bing.net/th/id/OIP.6ovpqbKMeQO3k-48Le01IAHaEU?pid=Api&P=0&h=180" 
                     alt="Right Logo">
            </div>
        </div>
    </div>

    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="dashboard-title">üìä FACULTY DASHBOARD</div>
        <div class="user-info">
            <span>üë®‚Äçüè´ Welcome, Faculty</span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- Main Layout -->
    <div class="main-layout">
        
        <!-- Left Sidebar -->
        <aside class="left-sidebar">
            <div class="sidebar-title">üìö ACADEMICS</div>
            
            <div class="selection-group">
                <label for="branchSelect">üè¢ Select Branch</label>
                <select id="branchSelect" onchange="updateSelection()">
                    <option value="">-- Select Branch --</option>
                    <option value="CSE">Computer Science Engineering</option>
                    <option value="AIML">AI & Machine Learning</option>
                    <option value="ECE">Electronics & Communication</option>
                    <option value="EEE">Electrical & Electronics</option>
                    <option value="MECH">Mechanical Engineering</option>
                    <option value="CIVIL">Civil Engineering</option>
                </select>
            </div>
            
            <div class="selection-group">
                <label for="sectionSelect">üìã Select Section</label>
                <select id="sectionSelect" onchange="updateSelection()">
                    <option value="">-- Select Section --</option>
                    <option value="A">Section - A</option>
                    <option value="B">Section - B</option>
                </select>
            </div>
            
            <div class="selection-info">
                <h4>üìå Current Selection</h4>
                <p><strong>Branch:</strong> <span id="selectedBranch">Not Selected</span></p>
                <p><strong>Section:</strong> <span id="selectedSection">Not Selected</span></p>
                <p><strong>Class:</strong> <span id="selectedClass">--</span></p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Statistics Cards -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <h3>Total Students</h3>
                        <div class="stat-number" id="totalStudents">0</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-info">
                        <h3>Present Today</h3>
                        <div class="stat-number" id="presentCount">0</div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-info">
                        <h3>Attendance %</h3>
                        <div class="stat-number" id="attendancePercent">0%</div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel">
                <h2>üéõÔ∏è Control Panel</h2>
                <div class="control-buttons">
                    <button class="btn btn-primary" id="startBtn" onclick="startAttendance()">
                        <span>‚ñ∂Ô∏è</span> Start Attendance
                    </button>
                    <button class="btn btn-danger" id="stopBtn" onclick="stopAttendance()" disabled>
                        <span>‚èπÔ∏è</span> Stop Attendance
                    </button>
                    <button class="btn btn-secondary" onclick="refreshAttendance()">
                        <span>üîÑ</span> Refresh Data
                    </button>
                    <button class="btn btn-secondary" onclick="downloadCSV()">
                        <span>üì•</span> Download CSV
                    </button>
                </div>
            </div>

            <!-- Attendance Table -->
            <div class="attendance-section">
                <h2>üìã Today's Attendance Record</h2>
                <div class="table-container">
                    <table id="attendanceTable">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Student Name</th>
                                <th>Roll No</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceBody">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    Please select Branch and Section to view attendance records.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </main>

    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- JavaScript -->
    <script>
        // Configuration
        const CONFIG = {
            API_BASE_URL: 'http://localhost:5000',
            POLLING_INTERVAL: 3000
        };

        let attendanceInterval = null;
        let isAttendanceRunning = false;
        let currentBranch = '';
        let currentSection = '';

        // Toast System
        const Toast = {
            element: document.getElementById('toast'),
            show(message, type = 'success') {
                this.element.textContent = message;
                this.element.className = `toast show ${type}`;
                setTimeout(() => {
                    this.element.classList.remove('show');
                }, 3000);
            }
        };

        // Update selection display
        function updateSelection() {
            const branchSelect = document.getElementById('branchSelect');
            const sectionSelect = document.getElementById('sectionSelect');
            
            currentBranch = branchSelect.value;
            currentSection = sectionSelect.value;
            
            document.getElementById('selectedBranch').textContent = 
                currentBranch ? branchSelect.options[branchSelect.selectedIndex].text : 'Not Selected';
            document.getElementById('selectedSection').textContent = 
                currentSection ? `Section - ${currentSection}` : 'Not Selected';
            document.getElementById('selectedClass').textContent = 
                (currentBranch && currentSection) ? `${currentBranch}-${currentSection}` : '--';
            
            if (currentBranch && currentSection) {
                Toast.show(`Selected: ${currentBranch}-${currentSection}`, 'success');
                loadAttendance();
            }
        }

        // Load attendance data
        async function loadAttendance() {
            if (!currentBranch || !currentSection) {
                console.log('No branch/section selected yet');
                return;
            }

            try {
                const response = await fetch(
                    `${CONFIG.API_BASE_URL}/api/attendance/today?branch=${currentBranch}&section=${currentSection}`
                );
                
                if (!response.ok) {
                    throw new Error('Failed to load attendance');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    updateDashboard(data.data);
                } else {
                    console.error('API returned error:', data.error);
                }
            } catch (error) {
                console.error('Error loading attendance:', error);
                // Don't show error toast repeatedly during polling
                if (!isAttendanceRunning) {
                    Toast.show('Error loading attendance data', 'error');
                }
            }
        }

        // Update dashboard with attendance data
        function updateDashboard(data) {
            document.getElementById('totalStudents').textContent = data.total || 0;
            document.getElementById('presentCount').textContent = data.present || 0;
            
            const percentage = data.total > 0 ? ((data.present / data.total) * 100).toFixed(1) : 0;
            document.getElementById('attendancePercent').textContent = percentage + '%';

            const tbody = document.getElementById('attendanceBody');
            
            if (data.records && data.records.length > 0) {
                tbody.innerHTML = data.records.map((record, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${record.name}</td>
                        <td>${record.rollNo || '--'}</td>
                        <td>${record.date}</td>
                        <td>${record.time}</td>
                        <td><span class="status-badge status-present">Present</span></td>
                    </tr>
                `).join('');
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            No attendance records for ${currentBranch}-${currentSection} today.
                        </td>
                    </tr>
                `;
            }
        }

        // Start attendance recognition
        async function startAttendance() {
            if (!currentBranch || !currentSection) {
                Toast.show('Please select Branch and Section first!', 'error');
                return;
            }

            try {
                console.log(`Starting attendance for ${currentBranch}-${currentSection}`);
                
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/attendance/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        branch: currentBranch,
                        section: currentSection
                    })
                });
                
                const data = await response.json();
                console.log('Response:', data);
                
                if (data.success) {
                    isAttendanceRunning = true;
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    
                    // Show message with instructions
                    Toast.show(`‚úÖ Camera window opened! Look for new window`, 'success');
                    
                    // Show alert with instructions
                    setTimeout(() => {
                        alert(`üì∏ ATTENDANCE STARTED!\n\n‚úÖ A new window has opened with the camera\n‚úÖ Students should look at the camera\n‚úÖ Attendance will be marked automatically\n\n‚ö†Ô∏è If camera window didn't open:\n   1. Check backend terminal for errors\n   2. Or run manually: python recognize_attendance.py ${currentBranch} ${currentSection}`);
                    }, 500);
                    
                    // Start polling for updates
                    attendanceInterval = setInterval(loadAttendance, CONFIG.POLLING_INTERVAL);
                } else {
                    Toast.show('‚ùå Failed: ' + (data.message || 'Unknown error'), 'error');
                    
                    // Show manual start option
                    const useManual = confirm('‚ùå Automatic start failed.\n\nWould you like to see manual start instructions?');
                    if (useManual) {
                        showManualStart();
                    }
                }
            } catch (error) {
                console.error('Error starting attendance:', error);
                Toast.show('‚ùå Error: ' + error.message, 'error');
                
                // Show manual start option
                const useManual = confirm('‚ùå Cannot connect to backend.\n\nMake sure backend is running:\n  python app.py\n\nWould you like manual start instructions?');
                if (useManual) {
                    showManualStart();
                }
            }
        }
        
        // Show manual start instructions
        function showManualStart() {
            const instructions = `
üì∏ MANUAL START INSTRUCTIONS

1. Open a NEW Command Prompt/Terminal

2. Navigate to backend folder:
   cd D:\\Smart Ai Attendence New\\backend

3. Run this command:
   python recognize_attendance.py ${currentBranch} ${currentSection}

4. Camera window will open

5. After marking attendance, close camera window

6. Click "Refresh Data" button here to see results

Press OK to continue...
            `;
            alert(instructions);
            
            // Enable buttons for manual mode
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            attendanceInterval = setInterval(loadAttendance, CONFIG.POLLING_INTERVAL);
        }

        // Stop attendance recognition
        async function stopAttendance() {
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/api/attendance/stop`, {
                    method: 'POST'
                });
                const data = await response.json();
                
                if (data.success) {
                    isAttendanceRunning = false;
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                    
                    if (attendanceInterval) {
                        clearInterval(attendanceInterval);
                        attendanceInterval = null;
                    }
                    
                    Toast.show('‚èπÔ∏è Attendance system stopped', 'success');
                    
                    // Wait 2 seconds then reload attendance
                    setTimeout(() => {
                        loadAttendance();
                    }, 2000);
                }
            } catch (error) {
                console.error('Error stopping attendance:', error);
                Toast.show('‚ùå Error: ' + error.message, 'error');
            }
        }

        // Refresh attendance data
        function refreshAttendance() {
            if (!currentBranch || !currentSection) {
                Toast.show('Please select Branch and Section first!', 'error');
                return;
            }
            Toast.show('üîÑ Refreshing data...', 'success');
            loadAttendance();
        }

        // Download CSV
        async function downloadCSV() {
            if (!currentBranch || !currentSection) {
                Toast.show('Please select Branch and Section first!', 'error');
                return;
            }

            try {
                Toast.show('üì• Downloading CSV...', 'success');
                
                const response = await fetch(
                    `${CONFIG.API_BASE_URL}/api/attendance/export?branch=${currentBranch}&section=${currentSection}`
                );
                const blob = await response.blob();
                
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `attendance_${currentBranch}_${currentSection}_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                Toast.show('‚úÖ CSV downloaded successfully!', 'success');
            } catch (error) {
                console.error('Error downloading CSV:', error);
                Toast.show('‚ùå Error downloading CSV', 'error');
            }
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                if (attendanceInterval) {
                    clearInterval(attendanceInterval);
                }
                Toast.show('üëã Logging out...', 'success');
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 1000);
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìä Faculty Dashboard Initialized');
            
            // Check backend connection
            checkBackendConnection();
        });
        
        // Check if backend is running
        async function checkBackendConnection() {
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/`);
                const data = await response.json();
                console.log('‚úÖ Backend connected:', data.message);
            } catch (error) {
                console.error('‚ùå Backend not connected:', error);
                
                setTimeout(() => {
                    const start = confirm('‚ö†Ô∏è WARNING: Cannot connect to backend!\n\nBackend must be running for attendance to work.\n\nStart backend now?\n\nOpen terminal and run:\n  cd backend\n  python app.py\n\nClick OK after starting backend, or Cancel to continue anyway.');
                    
                    if (start) {
                        // Retry connection
                        setTimeout(() => {
                            checkBackendConnection();
                        }, 3000);
                    }
                }, 1000);
            }
        }
    </script>

</body>
</html>